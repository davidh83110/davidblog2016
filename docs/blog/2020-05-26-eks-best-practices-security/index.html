<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>EKS Best Practices - Security - David&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="generator" content="Hugo 0.71.1" /><meta itemprop="name" content="EKS Best Practices - Security">
<meta itemprop="description" content="Introduction  ä¸ä¹…å‰ AWS å‡ºäº†ä¸€æœ¬ EKS Best Practices (Mkdocs)ï¼Œç›®å‰åªæœ‰é‡‹å‡º Security çš„éƒ¨åˆ†ï¼Œä½†å¾ Repository å¯ä»¥çœ‹åˆ°æœªä¾†æ‡‰è©²é‚„æœƒæœ‰ Cost optimization / Operation / Performance / Reliability çš„éƒ¨åˆ†ã€‚ ç”±æ–¼ç›®å‰åªæœ‰ Security çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±èŠ±äº†å¹¾å¤©æŠŠå®ƒçœ‹å®Œï¼Œç™¼ç¾é€™çœŸçš„å€‹å¥½æ±è¥¿ï¼Œé‚£ç¨®æ„Ÿè¦ºå·®ä¸å¤šæ˜¯ä½ å°±è·Ÿè‘—ä»–è·Ÿä½ èªªçš„å¯¦è¸å»åšï¼Œåˆå­¸è€…ä¹Ÿä¸æœƒå¤ªåé›¢è»Œé“ã€‚
æ ¹æ“š AWS è‡ªå·±èªªçš„ AWS æœƒè² è²¬é›²çš„å®‰å…¨ (security of the cloud)ï¼Œä½†ä½¿ç”¨è€…è¦è² è²¬è‡ªå·±åœ¨é›²ä¸Šçš„å®‰å…¨ (security in the cloud)ã€‚ æ‰€ä»¥æˆ‘å€‘å°±ä¾†çœ‹çœ‹æˆ‘å€‘éœ€è¦åšåˆ°å“ªäº›äº‹æ‰å¯ä»¥ ç›¡é‡ å®‰å…¨çš„ä½¿ç”¨ EKSã€‚ç”±æ–¼é€™ä»½æ–‡ä»¶èªªé•·ä¸é•·ï¼ŒèªªçŸ­ä¸çŸ­ï¼Œçœ‹å®Œé‚„æ˜¯è¦ä¸€é»æ™‚é–“ï¼Œå°¤å…¶åˆæ˜¯è‹±æ–‡ï¼Œæ‰€ä»¥æˆ‘çœ‹å®Œå¾Œæ•´ç†äº†ä¸€ä¸‹é‡é»è·Ÿç¿»è­¯å¯ä»¥çµ¦è‡ªå·±ç•¶æˆç­†è¨˜ã€‚
è¦ºå¾—è‡ªå·±çœ‹çš„æ»¿ä»”ç´°çš„ï¼Œé‚„æäº¤äº† 5 å€‹ PRï¼Œæƒ³èªªä»¥æ­¤åšå€‹ç­†è¨˜ä»¥ä¾¿æ—¥å¾Œå›ä¾†çœ‹ï¼Œå¯«ä¸‹ä¾†çš„ç­†è¨˜æ•´ç†æ°¸é æ˜¯å¾ˆå¥½çš„è¤‡ç¿’è·ŸåŠ æ·±è¨˜æ†¶çš„æ–¹å¼ã€‚
é€™è£¡é™„ä¸ŠåŸ Repository è·ŸåŸæ–‡ Mkdocs Siteã€‚
Github - https://github.com/aws/aws-eks-best-practices
Mkdocs Site - https://aws.github.io/aws-eks-best-practices/

ç›®éŒ„  ä»¥ä¸‹å…§å®¹æœƒåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†è¬›ï¼Œç›¡é‡ Follow åŸæ–‡çš„çµæ§‹ã€‚
 EKS &amp; IAM EKS IAM Role for ServiceAccounts (IRSA) EKS Pod Security EKS Tenant Security EKS Detective Control EKS Network Security EKS Security Groups EKS Runtime Security EKS Infrastructure(Worker Node) Security">
<meta itemprop="datePublished" content="2020-06-07T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-06-07T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="1511">
<meta itemprop="image" content="https://live.staticflickr.com/65535/49970338736_ffd25b0434_b.jpg">



<meta itemprop="keywords" content="" /><meta property="og:title" content="EKS Best Practices - Security" />
<meta property="og:description" content="Introduction  ä¸ä¹…å‰ AWS å‡ºäº†ä¸€æœ¬ EKS Best Practices (Mkdocs)ï¼Œç›®å‰åªæœ‰é‡‹å‡º Security çš„éƒ¨åˆ†ï¼Œä½†å¾ Repository å¯ä»¥çœ‹åˆ°æœªä¾†æ‡‰è©²é‚„æœƒæœ‰ Cost optimization / Operation / Performance / Reliability çš„éƒ¨åˆ†ã€‚ ç”±æ–¼ç›®å‰åªæœ‰ Security çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±èŠ±äº†å¹¾å¤©æŠŠå®ƒçœ‹å®Œï¼Œç™¼ç¾é€™çœŸçš„å€‹å¥½æ±è¥¿ï¼Œé‚£ç¨®æ„Ÿè¦ºå·®ä¸å¤šæ˜¯ä½ å°±è·Ÿè‘—ä»–è·Ÿä½ èªªçš„å¯¦è¸å»åšï¼Œåˆå­¸è€…ä¹Ÿä¸æœƒå¤ªåé›¢è»Œé“ã€‚
æ ¹æ“š AWS è‡ªå·±èªªçš„ AWS æœƒè² è²¬é›²çš„å®‰å…¨ (security of the cloud)ï¼Œä½†ä½¿ç”¨è€…è¦è² è²¬è‡ªå·±åœ¨é›²ä¸Šçš„å®‰å…¨ (security in the cloud)ã€‚ æ‰€ä»¥æˆ‘å€‘å°±ä¾†çœ‹çœ‹æˆ‘å€‘éœ€è¦åšåˆ°å“ªäº›äº‹æ‰å¯ä»¥ ç›¡é‡ å®‰å…¨çš„ä½¿ç”¨ EKSã€‚ç”±æ–¼é€™ä»½æ–‡ä»¶èªªé•·ä¸é•·ï¼ŒèªªçŸ­ä¸çŸ­ï¼Œçœ‹å®Œé‚„æ˜¯è¦ä¸€é»æ™‚é–“ï¼Œå°¤å…¶åˆæ˜¯è‹±æ–‡ï¼Œæ‰€ä»¥æˆ‘çœ‹å®Œå¾Œæ•´ç†äº†ä¸€ä¸‹é‡é»è·Ÿç¿»è­¯å¯ä»¥çµ¦è‡ªå·±ç•¶æˆç­†è¨˜ã€‚
è¦ºå¾—è‡ªå·±çœ‹çš„æ»¿ä»”ç´°çš„ï¼Œé‚„æäº¤äº† 5 å€‹ PRï¼Œæƒ³èªªä»¥æ­¤åšå€‹ç­†è¨˜ä»¥ä¾¿æ—¥å¾Œå›ä¾†çœ‹ï¼Œå¯«ä¸‹ä¾†çš„ç­†è¨˜æ•´ç†æ°¸é æ˜¯å¾ˆå¥½çš„è¤‡ç¿’è·ŸåŠ æ·±è¨˜æ†¶çš„æ–¹å¼ã€‚
é€™è£¡é™„ä¸ŠåŸ Repository è·ŸåŸæ–‡ Mkdocs Siteã€‚
Github - https://github.com/aws/aws-eks-best-practices
Mkdocs Site - https://aws.github.io/aws-eks-best-practices/

ç›®éŒ„  ä»¥ä¸‹å…§å®¹æœƒåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†è¬›ï¼Œç›¡é‡ Follow åŸæ–‡çš„çµæ§‹ã€‚
 EKS &amp; IAM EKS IAM Role for ServiceAccounts (IRSA) EKS Pod Security EKS Tenant Security EKS Detective Control EKS Network Security EKS Security Groups EKS Runtime Security EKS Infrastructure(Worker Node) Security" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2020-05-26-eks-best-practices-security/" />
<meta property="og:image" content="https://live.staticflickr.com/65535/49970338736_ffd25b0434_b.jpg" />
<meta property="article:published_time" content="2020-06-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-07T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://live.staticflickr.com/65535/49970338736_ffd25b0434_b.jpg"/>

<meta name="twitter:title" content="EKS Best Practices - Security"/>
<meta name="twitter:description" content="Introduction  ä¸ä¹…å‰ AWS å‡ºäº†ä¸€æœ¬ EKS Best Practices (Mkdocs)ï¼Œç›®å‰åªæœ‰é‡‹å‡º Security çš„éƒ¨åˆ†ï¼Œä½†å¾ Repository å¯ä»¥çœ‹åˆ°æœªä¾†æ‡‰è©²é‚„æœƒæœ‰ Cost optimization / Operation / Performance / Reliability çš„éƒ¨åˆ†ã€‚ ç”±æ–¼ç›®å‰åªæœ‰ Security çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±èŠ±äº†å¹¾å¤©æŠŠå®ƒçœ‹å®Œï¼Œç™¼ç¾é€™çœŸçš„å€‹å¥½æ±è¥¿ï¼Œé‚£ç¨®æ„Ÿè¦ºå·®ä¸å¤šæ˜¯ä½ å°±è·Ÿè‘—ä»–è·Ÿä½ èªªçš„å¯¦è¸å»åšï¼Œåˆå­¸è€…ä¹Ÿä¸æœƒå¤ªåé›¢è»Œé“ã€‚
æ ¹æ“š AWS è‡ªå·±èªªçš„ AWS æœƒè² è²¬é›²çš„å®‰å…¨ (security of the cloud)ï¼Œä½†ä½¿ç”¨è€…è¦è² è²¬è‡ªå·±åœ¨é›²ä¸Šçš„å®‰å…¨ (security in the cloud)ã€‚ æ‰€ä»¥æˆ‘å€‘å°±ä¾†çœ‹çœ‹æˆ‘å€‘éœ€è¦åšåˆ°å“ªäº›äº‹æ‰å¯ä»¥ ç›¡é‡ å®‰å…¨çš„ä½¿ç”¨ EKSã€‚ç”±æ–¼é€™ä»½æ–‡ä»¶èªªé•·ä¸é•·ï¼ŒèªªçŸ­ä¸çŸ­ï¼Œçœ‹å®Œé‚„æ˜¯è¦ä¸€é»æ™‚é–“ï¼Œå°¤å…¶åˆæ˜¯è‹±æ–‡ï¼Œæ‰€ä»¥æˆ‘çœ‹å®Œå¾Œæ•´ç†äº†ä¸€ä¸‹é‡é»è·Ÿç¿»è­¯å¯ä»¥çµ¦è‡ªå·±ç•¶æˆç­†è¨˜ã€‚
è¦ºå¾—è‡ªå·±çœ‹çš„æ»¿ä»”ç´°çš„ï¼Œé‚„æäº¤äº† 5 å€‹ PRï¼Œæƒ³èªªä»¥æ­¤åšå€‹ç­†è¨˜ä»¥ä¾¿æ—¥å¾Œå›ä¾†çœ‹ï¼Œå¯«ä¸‹ä¾†çš„ç­†è¨˜æ•´ç†æ°¸é æ˜¯å¾ˆå¥½çš„è¤‡ç¿’è·ŸåŠ æ·±è¨˜æ†¶çš„æ–¹å¼ã€‚
é€™è£¡é™„ä¸ŠåŸ Repository è·ŸåŸæ–‡ Mkdocs Siteã€‚
Github - https://github.com/aws/aws-eks-best-practices
Mkdocs Site - https://aws.github.io/aws-eks-best-practices/

ç›®éŒ„  ä»¥ä¸‹å…§å®¹æœƒåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†è¬›ï¼Œç›¡é‡ Follow åŸæ–‡çš„çµæ§‹ã€‚
 EKS &amp; IAM EKS IAM Role for ServiceAccounts (IRSA) EKS Pod Security EKS Tenant Security EKS Detective Control EKS Network Security EKS Security Groups EKS Runtime Security EKS Infrastructure(Worker Node) Security"/>
<link rel="stylesheet" href="/css/bundle.min.e1d75036348820992d6678792c1e34a42b08b0e79d420cc28f360046aeee6f37.css" integrity="sha256-4ddQNjSIIJktZnh5LB40pCsIsOedQgzCjzYARq7ubzc="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    <header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/">
        
          
            Blog
          
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu">
      
        
          
          
            <a href="/blog/" class="link"><i class='fa fa-hashtag'></i> Blog</a>
          
        
      
        
          
          
            <a href="https://davidh83110.com" class="link"><i class='fa fa-home'></i> Home</a>
          
        
      
        
          
          
            <a href="/about/" class="link"><i class='fa fa-code'></i> About</a>
          
        
      
        
          
          
            <a href="/categories/" class="link"><i class='fa fa-bars'></i> Categories</a>
          
        
      
        
          
          
            <a href="/archive/" class="link"><i class='fa fa-archive'></i> Archive</a>
          
        
      
      <a href="#share-menu" class="share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      

    </menu>
    

    <a href="#share-menu" class="share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    <a href="#site-nav" class="nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="lang-menu" class="flyout-menu">
  <a href="#" lang="en" class="link active">English (en)</a>
  
    
      
    
      
        <a href="/zh-tw" lang="zh-tw" class="no-lang link">ä¸­æ–‡ (zh-tw)</a>
      
    
  
</menu>

  
    <menu id="share-menu" class="flyout-menu">
      <h1>Share Post</h1>
      





  
    <a href="https://telegram.me/share/url?text=EKS%20Best%20Practices%20-%20Security&url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn telegram">
        <i class="fab fa-telegram-plane fa-5x"></i><p>&nbsp;Line</p>
      </a>
  

  
    <a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn line">
        <i class="fab fa-line fa-5x"></i><p>&nbsp;Line</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn facebook">
        <i class="fab fa-facebook"></i><p>&nbsp;Facebook</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f&amp;title=EKS%20Best%20Practices%20-%20Security" target="_blank" rel="noopener" class="share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by David&amp;body=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" class="share-btn email" data-proofer-ignore>
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  

  
    
    <a href="//twitter.com/share?text=EKS%20Best%20Practices%20-%20Security&amp;url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="/img/main/avator.jpg" class="circle" width="165px" alt="" /></a>
  <header>
    <h1>David Hsu</h1>
  </header>
  <main>
    
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/davidh83110" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/12397001" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>









<li><a href="//linkedin.com/in/david-hsu-b1136112b" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>




<li><a href="//facebook.com/ben12567" target="_blank" rel="noopener" title="Facebook" class="fab fa-facebook"></a></li>








<li><a href="//instagram.com/davidh.110" target="_blank" rel="noopener" title="Instagram" class="fab fa-instagram"></a></li>













<li><a href="mailto:davidh83110@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
      <ul style="padding: 0;">
        <p style="text-align: center;">
          DevOps Engineering / AWS / Cloud Native
        </p>
        <p style="text-align: center; opacity: 1;">
          <a href="https://www.certmetrics.com/amazon/public/badge.aspx?i=1&t=c&d=2019-11-09&ci=AWS00993116" target="_blank">
          <img src="https://www.certmetrics.com/api/ob/image/amazon/c/1" width=100px></a>
        </p>
      </ul>
    </footer>
  
</section>

      <main id="site-main">
        <article class="post">
  <header>
  <div class="title">
    
      <h2><a href="/blog/2020-05-26-eks-best-practices-security/">EKS Best Practices - Security</a></h2>
    
    
  </div>
  <div class="meta">
    <time class="published" datetime="2020-06-07 00:00:00 &#43;0000 UTC">
      June 7, 2020
    </time>
    <span class="author">David</span>
    
  </div>
</header>

  
  <a href="/blog/2020-05-26-eks-best-practices-security/" class="image featured">
    
    <p style="text-align: center;">
      <img src="https://live.staticflickr.com/65535/49970338736_ffd25b0434_b.jpg" alt="">
    </p>
    
  </a>


  <div class="content">
    <h2 id="introduction">Introduction</h2>
<hr>
<p>ä¸ä¹…å‰ AWS å‡ºäº†ä¸€æœ¬ EKS Best Practices (Mkdocs)ï¼Œç›®å‰åªæœ‰é‡‹å‡º Security çš„éƒ¨åˆ†ï¼Œä½†å¾ Repository å¯ä»¥çœ‹åˆ°æœªä¾†æ‡‰è©²é‚„æœƒæœ‰ Cost optimization / Operation / Performance / Reliability çš„éƒ¨åˆ†ã€‚ ç”±æ–¼ç›®å‰åªæœ‰ Security çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±èŠ±äº†å¹¾å¤©æŠŠå®ƒçœ‹å®Œï¼Œç™¼ç¾é€™çœŸçš„å€‹å¥½æ±è¥¿ï¼Œé‚£ç¨®æ„Ÿè¦ºå·®ä¸å¤šæ˜¯ä½ å°±è·Ÿè‘—ä»–è·Ÿä½ èªªçš„å¯¦è¸å»åšï¼Œåˆå­¸è€…ä¹Ÿä¸æœƒå¤ªåé›¢è»Œé“ã€‚</p>
<p>æ ¹æ“š AWS è‡ªå·±èªªçš„ AWS æœƒè² è²¬é›²çš„å®‰å…¨ (security of the cloud)ï¼Œä½†ä½¿ç”¨è€…è¦è² è²¬è‡ªå·±åœ¨é›²ä¸Šçš„å®‰å…¨ (security in the cloud)ã€‚ æ‰€ä»¥æˆ‘å€‘å°±ä¾†çœ‹çœ‹æˆ‘å€‘éœ€è¦åšåˆ°å“ªäº›äº‹æ‰å¯ä»¥ <code>ç›¡é‡</code> å®‰å…¨çš„ä½¿ç”¨ EKSã€‚ç”±æ–¼é€™ä»½æ–‡ä»¶èªªé•·ä¸é•·ï¼ŒèªªçŸ­ä¸çŸ­ï¼Œçœ‹å®Œé‚„æ˜¯è¦ä¸€é»æ™‚é–“ï¼Œå°¤å…¶åˆæ˜¯è‹±æ–‡ï¼Œæ‰€ä»¥æˆ‘çœ‹å®Œå¾Œæ•´ç†äº†ä¸€ä¸‹é‡é»è·Ÿç¿»è­¯å¯ä»¥çµ¦è‡ªå·±ç•¶æˆç­†è¨˜ã€‚</p>
<p>è¦ºå¾—è‡ªå·±çœ‹çš„æ»¿ä»”ç´°çš„ï¼Œé‚„æäº¤äº† 5 å€‹ PRï¼Œæƒ³èªªä»¥æ­¤åšå€‹ç­†è¨˜ä»¥ä¾¿æ—¥å¾Œå›ä¾†çœ‹ï¼Œå¯«ä¸‹ä¾†çš„ç­†è¨˜æ•´ç†æ°¸é æ˜¯å¾ˆå¥½çš„è¤‡ç¿’è·ŸåŠ æ·±è¨˜æ†¶çš„æ–¹å¼ã€‚</p>
<p>é€™è£¡é™„ä¸ŠåŸ Repository è·ŸåŸæ–‡ Mkdocs Siteã€‚</p>
<p><a href="https://github.com/aws/aws-eks-best-practices">Github - https://github.com/aws/aws-eks-best-practices</a><br>
<a href="https://aws.github.io/aws-eks-best-practices/">Mkdocs Site - https://aws.github.io/aws-eks-best-practices/</a></p>
<p><br /></p>
<h2 id="ç›®éŒ„">ç›®éŒ„</h2>
<hr>
<p>ä»¥ä¸‹å…§å®¹æœƒåˆ†æˆå¹¾å€‹éƒ¨åˆ†ä¾†è¬›ï¼Œç›¡é‡ Follow åŸæ–‡çš„çµæ§‹ã€‚</p>
<ul>
<li><a href="#EKS-IAM">EKS &amp; IAM</a></li>
<li><a href="#EKS-IRSA">EKS IAM Role for ServiceAccounts (IRSA)</a></li>
<li><a href="#EKS-POD">EKS Pod Security</a></li>
<li><a href="#EKS-TENANT">EKS Tenant Security</a></li>
<li><a href="#EKS-DETECTIVE">EKS Detective Control</a></li>
<li><a href="#EKS-Network-Security">EKS Network Security</a></li>
<li><a href="#EKS-SG">EKS Security Groups</a></li>
<li><a href="#EKS-RUNTIME">EKS Runtime Security</a></li>
<li><a href="#EKS-HOST">EKS Infrastructure(Worker Node) Security</a></li>
</ul>
<p><br /></p>
<h2 id="EKS-IAM">EKS &amp; IAM</h2>
<hr>
<h3 id="èªè­‰æµç¨‹">èªè­‰æµç¨‹</h3>
<p>é¦–å…ˆè¦å…ˆç†è§£ kubectl æ€éº¼è·Ÿ EKS åšèªè­‰ã€‚</p>
<p><img src="https://live.staticflickr.com/65535/49939885678_bd5fe9294b_b.jpg" alt="text"></p>
<p>åŸºæœ¬ä¸Šå°±æ˜¯ä½ ä¸‹ <code>kubectl get pod</code> -&gt; æœƒå»è¦ <code>token</code> -&gt; åœ¨æ‰“åˆ° <code>EKS API</code> -&gt; æª¢æŸ¥æ¬Šé™ <code>aws-auth (configMap)</code> -&gt; return result</p>
<p>å¦‚æœæƒ³æª¢æŸ¥ toekn ï¼Œå¯ä»¥å¾é€™é‚Šä¸‹æ‰‹ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws eks get-token --cluster &lt;cluster_name&gt;
</code></pre></div><p>é€™å€‹ Token é è¨­ TTL æ˜¯ 15 åˆ†é˜ï¼Œä¹Ÿå°±æ˜¯èªª 15 åˆ†é˜å¾Œå°±æœƒéæœŸï¼Œå¦‚æœä½¿ç”¨ Kube-Dashboard çš„äººå°±è¦æ³¨æ„ä¸€ä¸‹äº†ï¼Œæœƒæ¯”è¼ƒéº»ç…©ã€‚</p>
<p><br />
<br /></p>
<h3 id="recommendation">Recommendation</h3>
<p>AWS å»ºè­°æˆ‘å€‘åœ¨ IAM çš„éƒ¨åˆ†æ³¨æ„ä»¥ä¸‹å¹¾ä»¶äº‹</p>
<ul>
<li>
<p><strong>ç›¡é‡ä¸è¦ä½¿ç”¨ serviceaccount token ä¾†åšèªè­‰</strong><br>
å› ç‚º SA Token æ˜¯ long-lived çš„ï¼Œå¦‚æœé€™æŠŠ token è¢«å·äº†æˆ–æ˜¯ä½ æ‰åœ¨å“ªäº†è€Œä½ ä¸çŸ¥é“ï¼Œæ˜¯å¾ˆå±éšªçš„äº‹ï¼Œtoekn expiry çš„æ©Ÿåˆ¶æ˜¯ä¸€ç¨®ä¿è­·ã€‚ å°±ç®—æ˜¯ For CI/CD ä¹Ÿä¸è¦ç”¨ SA Tokenï¼Œæ‡‰è©²è¦çµ¦äºˆä¸€å€‹ IAM Roleã€‚</p>
</li>
<li>
<p><strong>IAM User æœ‰éœ€è¦è³¦äºˆ EKS ç›¸é—œçš„ Permission æ‰èƒ½ Access Cluster å—ï¼Ÿ</strong><br>
NO, absolutely not. <code>åªéœ€è¦åŠ åœ¨ aws-auth å°±å¯ä»¥äº†</code>ã€‚</p>
</li>
<li>
<p><strong>å¦‚æœä¸€æ¬¡è¦åŠ å¾ˆå¤šäººåˆ° aws-auth è©²æ€éº¼åšï¼Ÿ</strong><br>
ä¸éœ€è¦ä¸€å€‹ä¸€å€‹åŠ ï¼Œ<code>åŠ ä¸€å€‹ Role åˆ° aws-auth</code>ï¼Œç„¶å¾Œçµ¦ User Assume Role çš„æ¬Šé™å°±å¯ä»¥ï¼Œç›¸å°å¥½ç®¡ç†ã€‚</p>
</li>
<li>
<p><strong>RoleBinding / ClusterROleBinding æœ€å°æ¬Šé™</strong><br>
é¿å… <code>[&quot;*&quot;]</code> åœ¨è£¡é¢, ç›¡é‡ä¸€å€‹ä¸€å€‹æ¬Šé™çµ¦ã€‚ <code>audit2rbac</code> æ˜¯ä¸€å¥—æœƒè‡ªå‹•å¹«ä½ ä¾æ“š K8s audit log of API call å» grant role &amp; binding çš„å·¥å…·ã€‚
<a href="https://github.com/liggitt/audit2rbac">https://github.com/liggitt/audit2rbac</a></p>
</li>
<li>
<p><strong>Make EKS cluster endpoint <code>PRIVATE</code></strong><br>
EKS Endpoint é è¨­æ˜¯ publicï¼Œå…¶å¯¦ä¹Ÿæ˜¯å®‰å…¨ï¼Œå› ç‚ºé‚„æœ‰ IAM Auth çš„éæ¿¾æ©Ÿåˆ¶ï¼Œä½†ä½ é‚„æ˜¯æš´éœ²åœ¨ Internetã€‚ AWS å»ºè­°ç›¡é‡è¨­æˆ <code>private only</code>ï¼Œä½†é€™æ¨£ç†è«–ä¸Šä½ æœƒéœ€è¦ VPNã€‚<br>
å¦‚æœæƒ³è¦åœ¨æ–¹ä¾¿è·Ÿå®‰å…¨ä¹‹é–“å–ä¸€å€‹å¹³è¡¡é»æ˜¯å¯ä»¥è¨­å®šæˆ publicï¼Œä½†è«‹ <code>å‹™å¿…è¨­å®š CIDR Whitelist</code>ã€‚</p>
</li>
<li>
<p><strong>ç¶“å¸¸ Audit Access</strong><br>
ç¶“å¸¸çš„å»çœ‹ Cluster çš„ Access log (ç•¶ç„¶æ˜¯é€éå·¥å…·ï¼Œä¸ç„¶å°±å·¥äººæ™ºæ…§äº†)ï¼Œä»¥ä¸‹æœ‰æ¨è–¦å…©å¥—ã€‚<br>
<a href="https://github.com/FairwindsOps/rbac-lookup">https://github.com/FairwindsOps/rbac-lookup</a><br>
<a href="https://github.com/aquasecurity/kubectl-who-can">https://github.com/aquasecurity/kubectl-who-can</a></p>
</li>
<li>
<p><strong>é™¤äº† IAMï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ OIDCï¼ˆåšèªè­‰ï¼‰ï¼ŒGithub ä½¿ç”¨ OAUTHï¼ˆåšæˆæ¬Šï¼‰å­˜å– EKS (æˆ–æ˜¯ AWS SSO)</strong><br>
ä¸éæˆ‘è‡ªå·±ä¸€èˆ¬æƒ…æ³ä¸‹é‚„æ˜¯åå‘ç›¡é‡ä½¿ç”¨ IAMï¼ˆåå‘æ¬Šé™æ¯”è¼ƒå¯ä»¥ç›¡é‡é›†ä¸­å–®ä¸€ç®¡ç†ï¼Œè¼ƒä¸æ˜“ç™¼æ•£ï¼‰ã€‚ ä½†æ˜¯ä¹Ÿæœ‰çœ‹åˆ° Kubernetes-Dashboard / Kibana ä½¿ç”¨ OIDC çš„æ¡ˆä¾‹ï¼Œä¹Ÿæ˜¯æŒºä¸éŒ¯çš„ï¼ˆæˆ‘è¦ºå¾—å¦‚æœåªæœ‰è¦åš readï¼Œè€Œå¤§å®¶æ¬Šé™éƒ½å¯ä»¥çµ¦ä¸€æ¨£ readonly çš„è©±ï¼Œæ˜¯æ»¿é©åˆçš„ï¼‰ã€‚</p>
<ul>
<li>Kubernetes Dashboard SSO with OIDC <a href="https://thenewstack.io/single-sign-on-for-kubernetes-dashboard-experience/">https://thenewstack.io/single-sign-on-for-kubernetes-dashboard-experience/</a></li>
<li>EKS with Github  <a href="https://aws.amazon.com/blogs/opensource/authenticating-eks-github-credentials-teleport/">https://aws.amazon.com/blogs/opensource/authenticating-eks-github-credentials-teleport/</a></li>
<li>OIDC Proxy <a href="https://aws.amazon.com/blogs/opensource/consistent-oidc-authentication-across-multiple-eks-clusters-using-kube-oidc-proxy/">https://aws.amazon.com/blogs/opensource/consistent-oidc-authentication-across-multiple-eks-clusters-using-kube-oidc-proxy/</a></li>
</ul>
</li>
</ul>
<p><br /></p>
<h2 id="EKS-IRSA">EKS IAM Role for ServiceAccounts (IRSA)</h2>
<hr>
<h3 id="irsa-ä»‹ç´¹">IRSA ä»‹ç´¹</h3>
<p>é€™å€‹ä¸»é¡Œç‰¹åˆ¥æ‹‰å‡ºä¾†è¬›ï¼Œå› ç‚ºä»–æ˜¯ Kubernetes åŸç”Ÿæ‰€æ²’æœ‰çš„ã€‚ IRSA ç°¡å–®è¬›å°±æ˜¯<br>
<code>IAM Role</code> â†” <code>IRSA</code> â†” <code>ServiceAccount</code></p>
<p>æ•´å€‹è·Ÿèªè­‰çµåˆèµ·ä¾†å°±æœƒæ˜¯<br>
<code>Pod</code> â†’ <code>AWS OIDC</code> â†’ <code>EKS sign OIDC token</code> â†’ <code>AWS API</code> â†’ <code>AssumeRole</code> â†’ <code>IAM Role</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-md" data-lang="md">å°±æ˜¯ Pod æœƒç¶“é OIDC token å»äº¤æ› IAM Role ä¾†å­˜å– AWS Services (e.g. S3)
</code></pre></div><blockquote>
<p>ä¸Šé¢è¬›åˆ° Token ä¸éæœŸå¾ˆå±éšªï¼Œé€™é‚Šçš„ OIDC Token æœƒç”± <code>kubelet</code> å»æ›¿æ›ã€‚
æ›¿æ›çš„ä¾æ“šæ˜¯ç•¶é€™å€‹ Token é”åˆ° 80% TTL æˆ–è€…æ˜¯è¶…é 24HRã€‚</p>
</blockquote>
<p><br />
<br /></p>
<h3 id="recommendations">Recommendations</h3>
<ul>
<li>
<p><strong>Disable ä¸éœ€è¦çš„ ServiceAccount æ¬Šé™</strong><br>
å¦‚æœä½ çš„ applicaion ä¸éœ€è¦ä½¿ç”¨åˆ° K8S APIï¼Œå¯ä»¥è¨­å®š</p>
<pre><code>kubectl patch serviceaccount default -p $'automountServiceAccountToken: false'
</code></pre></li>
<li>
<p><strong>æ¯å€‹ Application éƒ½æœ‰è‡ªå·±å°ˆç”¨çš„ ServiceAccount æ¯”è¼ƒå¥½</strong><br>
å°±è·Ÿ ECS æ¯å€‹ task éƒ½æœ‰è‡ªå·±çš„ task role ä¸€æ¨£ã€‚ æ¬Šé™æœ€å°åŒ–ã€‚</p>
</li>
<li>
<p><strong>Worker çš„ Instance Profile åªç•™å¿…è¦çš„</strong><br>
ç•¶æˆ‘å€‘ä½¿ç”¨ IRSA çš„æ™‚å€™, Pod å°±ä¸å†ä½¿ç”¨ Instance Profile äº†ï¼Œæ‰€ä»¥å¤§å¯å°‡å®ƒæ¬Šé™é–ä½ (block all)<br>
æˆ‘å€‘è¦è®“æ‰€æœ‰çš„ Pod éƒ½å¼·åˆ¶ä½¿ç”¨ IRSA (ä¹Ÿå°±æ˜¯èµ° Service account â†’ IAM Role çš„æˆæ¬Šæ–¹å¼)</p>
</li>
<li>
<p><strong>ä½¿ç”¨é Root çš„ç”¨æˆ¶ä¾†å•Ÿå‹• Containers (<code>runAsUser</code> / <code>runAsGroup</code>)</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">apiVersion</span>: v1
<span style="color:#66d9ef">kind</span>: Pod
<span style="color:#66d9ef">metadata</span>:
  <span style="color:#66d9ef">name</span>: security-context-demo
<span style="color:#66d9ef">spec</span>:
  <span style="color:#66d9ef">securityContext</span>:
    <span style="color:#66d9ef">runAsUser</span>: <span style="color:#ae81ff">1000</span>
    <span style="color:#66d9ef">runAsGroup</span>: <span style="color:#ae81ff">3000</span>
  <span style="color:#66d9ef">containers</span>:
  - <span style="color:#66d9ef">name</span>: sec-ctx-demo
    <span style="color:#66d9ef">image</span>: busybox
    <span style="color:#66d9ef">command</span>: [ <span style="color:#e6db74">&#34;sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;sleep 1h&#34;</span> ]
</code></pre></div></li>
<li>
<p><strong>IRSA çš„ Role Trusted Relationship ç›¡é‡ç¶å®š service account</strong><br>
é€™æ˜¯æŒ‡ trusted relationship é‚£é‚Šçš„è¨­å®šï¼Œå»ºå®Œ Role ä¹‹å¾Œè¦æ‰‹å‹•å»æ”¹ ï¼ˆå»ºç«‹çš„æ™‚å€™æ²’æœ‰é€™é¸é …ï¼‰
ç¯„ä¾‹ä¸­å°±æ˜¯å°‡é€™å€‹ Role é™åˆ¶åœ¨ <code>deault namespace</code> çš„ <code>exteranl-dns service account</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">{
  <span style="color:#66d9ef">&#34;Version&#34;: </span><span style="color:#e6db74">&#34;2012-10-17&#34;</span>,
  <span style="color:#66d9ef">&#34;Statement&#34;: </span>[
    {
      <span style="color:#66d9ef">&#34;Effect&#34;: </span><span style="color:#e6db74">&#34;Allow&#34;</span>,
      <span style="color:#66d9ef">&#34;Principal&#34;: </span>{
        <span style="color:#66d9ef">&#34;Federated&#34;: </span><span style="color:#e6db74">&#34;arn:aws:iam::xx:oidc-provider/oidc.eks.ap-northeast-1.amazonaws.com/id/xxx&#34;</span>
      },
      <span style="color:#66d9ef">&#34;Action&#34;: </span><span style="color:#e6db74">&#34;sts:AssumeRoleWithWebIdentity&#34;</span>,
      <span style="color:#66d9ef">&#34;Condition&#34;: </span>{
        <span style="color:#66d9ef">&#34;StringEquals&#34;: </span>{
          <span style="color:#66d9ef">&#34;oidc.eks.ap-northeast-1.amazonaws.com/id/xx:sub&#34;: </span><span style="color:#e6db74">&#34;system:serviceaccount:default:external-dns&#34;</span>
        }
      }
    }
  ]
}
</code></pre></div></li>
</ul>
<p><br />
<br /></p>
<h3 id="irsa-çš„é™åˆ¶">IRSA çš„é™åˆ¶</h3>
<p>å„˜ç®¡ IRSA å¾ˆç¾å¥½ï¼Œå¯ä»¥å¹«ä½ è·Ÿ AWS æºé€šï¼Œä½†ä»–ä¹Ÿæœ‰é™åˆ¶ï¼Œå°±æ˜¯ Application ä½¿ç”¨çš„ <code>AWS SDK ç‰ˆæœ¬å•é¡Œ</code>ã€‚<br>
ä½ å¿…é ˆè¦ç¢ºä¿ä½ çš„ SDK ç‰ˆæœ¬å¯ä»¥æ”¯æ´ IRSA (å¤ªèˆŠä¸è¡Œ)ã€‚ å¦‚æœä¸æ”¯æ´ï¼Œå¯ä»¥ä½¿ç”¨ kube2iam æˆ–æ˜¯ kiam ä¾†æ›¿ä»£ã€‚</p>
<p><br /></p>
<h2 id="EKS-POD">EKS Pod Security</h2>
<hr>
<h3 id="pod-security-policy-psp">Pod Security Policy (PSP)</h3>
<p>PSP æ˜¯ç”¨ä¾†æ§åˆ¶ Pod æ¬Šé™çš„ï¼Œè€Œ EKS å»ºç«‹æ™‚æœƒè‡ªå‹•å»ºç«‹ä¸€å€‹ <code>eks.privileged</code> PSPã€‚</p>
<p>å”åŠ©ç®¡ç† PSP çš„å·¥å…· - <a href="https://github.com/sysdiglabs/kube-psp-advisor">kube-psp-advisor</a></p>
<p><br /></p>
<h3 id="recommendations-1">Recommendations</h3>
<ul>
<li>
<p><strong>Pod åªè¦è¨­å®š <code>privileged</code> å°±å¯ä»¥æ‹¿åˆ°å¾ˆå¤š Node ä¸Š root çš„æ¬Šé™ï¼Œéœ€è¦ç›¡é‡é¿å…ã€‚</strong></p>
</li>
<li>
<p><strong>Container é¿å…ä½¿ç”¨ root å•Ÿå‹•ï¼Œä¹Ÿä¸è¦çµ¦ sudo æ¬Šé™</strong><br>
æœ‰ root æ¬Šé™çš„ Podï¼Œç›¸å°æœ‰æ©Ÿæœƒè¢«é€²è¡Œææ¬Šæ”»æ“Šï¼Œæœƒå»ºè­°ä½¿ç”¨è€…ç›¡é‡ä½¿ç”¨ PSP å»å¼·åˆ¶è¦ç¯„ã€‚<br>
å¯ä»¥è€ƒæ…®é€²è¡Œä»¥ä¸‹æ­¥é©Ÿä¾†åŠ å¼·å®‰å…¨æ€§ï¼š</p>
<ul>
<li>ç§»é™¤ <code>shell</code></li>
<li>æŒ‡å®š non-root çš„ user åœ¨ Dockerfile</li>
<li>Podspec.securityContext å…§å¯ä»¥æŒ‡å®šé‹è¡Œçš„ User (<code>runAsUser</code> / <code>runAsGroup</code>)</li>
</ul>
</li>
<li>
<p><strong>ä¸è¦ Docker in Docker</strong><br>
é€™æ¨£ä¸€ä¾† Node å°±ç„¡æ³•å¹«ä½ ç®¡ç† in Docker çš„é€™å€‹ Containerï¼Œæœƒå¾ˆå±éšªï¼Œç­‰æ–¼ä½ åªå—åˆ°ä¸Šä¸€éšå±¤çš„ Container ç›´æ¥ç®¡ç†è€Œå·²ã€‚</p>
</li>
<li>
<p><strong>é¿å…ä½¿ç”¨<code>hostPath</code></strong><br>
åœ¨ Serverless çš„è§’åº¦ï¼Œæˆ‘ä¹Ÿè¦ºå¾—ç›¡é‡ä¸è¦å­˜æ±è¥¿åœ¨ Host ä¸Šï¼Œå¯ä»¥è€ƒæ…® EFS æˆ–ç›´æ¥ä½¿ç”¨ Fargateã€‚
AWS åœ¨é€™é‚Šæ˜¯èªªçœŸçš„è¦ç”¨çš„è©±è¨˜å¾—è¦æ³¨æ„æ¬Šé™ (readonly è©²çµ¦çš„è¦çµ¦)ã€‚<br>
å¦å¤–ä¹Ÿå¯ä»¥åœ¨ PSP å…ˆåšå¥½é™åˆ¶ï¼ˆå¦‚ä¸‹é¢ç¯„ä¾‹ï¼‰ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">allowedHostPaths</span>:
<span style="color:#75715e"># This allows &#34;/foo&#34;, &#34;/foo/&#34;, &#34;/foo/bar&#34; etc., but</span>
<span style="color:#75715e"># disallows &#34;/fool&#34;, &#34;/etc/foo&#34; etc.</span>
<span style="color:#75715e"># &#34;/foo/../&#34; is never valid.</span>
- <span style="color:#66d9ef">pathPrefix</span>: <span style="color:#e6db74">&#34;/foo&#34;</span>
    <span style="color:#66d9ef">readOnly</span>: <span style="color:#66d9ef">true</span> <span style="color:#75715e"># only allow read-only mounts</span>
</code></pre></div></li>
</ul>
<p><br /></p>
<h3 id="quality-of-service-qos">Quality of Service (QoS)</h3>
<p>Kubernetes ä½¿ç”¨ QoS å»æ’åˆ—å„ªå…ˆåº¦ï¼Œæ±ºå®šä»€éº¼æ™‚å€™è¦æ®ºæ‰å“ªäº› Podã€‚<br>
QoS å¾ˆé‡è¦ï¼Œä¸åƒ…æ˜¯è³‡æºåˆ©ç”¨è·Ÿæ•ˆç‡çš„å•é¡Œï¼Œè¨­å®šä¸Šçš„å¤±èª¤ä¹Ÿæœƒé€ æˆ Pod ä¸€ç›´ evictedã€‚</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Priority</th>
<th>Condition</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>Guaranteed</td>
<td><code>highest</code></td>
<td>limit = request â‰  0  <br />(åªè¨­ limit, é‚£ request æœƒè‡ªå‹•ç­‰æ–¼ limit)</td>
<td>é™¤éè¶…é memory limit ä¸ç„¶ä¸æœƒè¢«æ®º</td>
</tr>
<tr>
<td>Burstable</td>
<td><code>medium</code></td>
<td>limit â‰  request â‰  0</td>
<td>è¶…é request memory å¾Œå¦‚æœ Node è³‡æºä¸å¤ å°±æœƒè¢«æ®º</td>
</tr>
<tr>
<td>Best Effort</td>
<td><code>lowest</code></td>
<td>limit &amp; request = null</td>
<td>è³‡æºä¸å¤ æœ€æ—©è¢«æ®º</td>
</tr>
</tbody>
</table>
<p>è£½ä½œäº†ä¸€å¼µè¡¨ä¾†çœ‹ QoS çš„åˆ†ç´šï¼Œç”±æ­¤å¯è¦‹å¦‚æœ <code>request</code> è·Ÿ <code>limit</code> éƒ½ä¸è¨­å®šï¼Œé‚£å°±æœƒç›¸å°æ¯”è¼ƒå±éšª (Pod ä¹‹é–“åœ¨è³‡æºä¸è¶³çš„æ™‚å€™æœƒç«¶çˆ­)ã€‚
å¦å¤–è¨­å®š QoS ä¹Ÿå¯ä»¥é–“æ¥çš„é˜²æ­¢ DOS Attackï¼Œé¿å… Node ä¸Šçš„è³‡æºä¸€ç›´è¢«æŸå€‹ Pod éåº¦èª¿åº¦é€ æˆå…¶ä»– Pod éƒ½è¢« kubelet é©…é€ (evicted)ã€‚</p>
<p><br ></p>
<p><strong><code>Request</code> &amp; <code>Limit</code> æœ‰ä¸€äº›ç‰¹é»ï¼š</strong></p>
<ul>
<li>
<p>å°æ¯å€‹æœå‹™è¨­å®šä¸åŒçš„ QoS æ˜¯å¿…é ˆçš„ã€‚</p>
</li>
<li>
<p>ç›¡é‡é€é Namespace <code>Quota</code> å’Œ <code>Limit Range</code> å»åšé™åˆ¶ã€‚</p>
<ul>
<li>Namespace Quota å¯ä»¥æ±ºå®šè¦çµ¦è£¡é¢çš„ Pod å¤šå°‘è³‡æºï¼ˆTotal amount of resourcesï¼‰ã€‚</li>
<li>Limit Range å¯ä»¥æ±ºå®š Namespace è£¡è³‡æºçš„ min/maxã€‚</li>
</ul>
</li>
<li>
<p>CPU æ˜¯å¯ä»¥è¶…é¡èª¿åº¦(oversubscribed) çš„ï¼ŒMemory ä¸è¡Œã€‚<br>
e.g. å¤šå®¹å™¨é–“ Memory æ˜¯ä¸èƒ½å…±äº«çš„ï¼Œä½† CPU å¯ä»¥ã€‚</p>
</li>
<li>
<p>ç•¶ Node ä¸Šå­˜åœ¨å…§å­˜å£“åŠ›æ™‚ (Memory pressure) ï¼Œè¶…é request memory ä½†æœªé” limit çš„ Pod å¯èƒ½æœƒè¢«çµ‚æ­¢ã€‚</p>
</li>
<li>
<p>Memory Limit å°æ‡‰åˆ°çš„æ˜¯ <code>cgroup</code> çš„ <code>memory.limit_in_bytes</code>ï¼Œæ‰€ä»¥è¶…éçš„ Pod æœƒç›´æ¥ OOM Killedã€‚ CPU Limit å¦‚æœè¶…éå‰‡æ˜¯æœƒå—åˆ°ç¯€æµ(throttled)ã€‚</p>
</li>
<li>
<p>Memory Request å‰‡ä¸å—åˆ° cgroup å½±éŸ¿ï¼Œä½†å¦‚ä¸Šé¢æ‰€èªªå¦‚æœ Node æœ‰å£“åŠ›é‚„æ˜¯æœƒè¢«çµ‚æ­¢çš„ã€‚</p>
</li>
</ul>
<p><br /></p>
<h2 id="EKS-TENANT">EKS Tenant Security</h2>
<hr>
<p>Kubernetes åœ¨å¤šç§Ÿæˆ¶ (Multiple Tenant) çš„æ‡‰ç”¨ä¸‹ï¼Œè¦æ€éº¼å»åšåˆ°å°æ¯å€‹ç§Ÿæˆ¶çš„<code>éš”é›¢</code>ï¼Œæ˜¯å¾ˆé‡è¦çš„ä¸€ä»¶äº‹ã€‚ æ‰€è¬‚<code>å¤šç§Ÿæˆ¶</code>ï¼Œå°±æ˜¯æŒ‡ä¸€çµ„æ‡‰ç”¨ç¨‹å¼æ‰€ä½¿ç”¨çš„è¨ˆç®—ï¼Œç¶²çµ¡ï¼Œå­˜å„²ç­‰è³‡æºçµ„æˆçš„å·¥ä½œè² è¼‰é›†åˆã€‚ä¹Ÿå°±æ˜¯èªªæœƒæœ‰éœ€è¦ä¸åŒè³‡æºçš„ä¸åŒæ‡‰ç”¨ç¨‹å¼è·‘åœ¨åŒä¸€å€‹ Kubernetes Clusterã€‚ è€Œå¦‚ä½•é©ç•¶éš”é›¢ä¸åŒæ‡‰ç”¨ï¼Œé¿å…æƒ¡æ„çš„ç§Ÿæˆ¶å»å°å…¶ä»–ç§Ÿæˆ¶åšæ”»æ“Šï¼Œä¸¦ä¿è­‰ç§Ÿæˆ¶é–“å¯ä»¥åˆ†é…åˆ°å„è‡ªåˆé©çš„è³‡æºï¼Œå°±æ˜¯é€™å€‹ section è¦æ¢è¨çš„ã€‚</p>
<p>Kubernetes Control Panel æœ¬èº«æ˜¯å–®ç§Ÿæˆ¶çš„å½¢å¼ (ä¸€å€‹ control panel çµ¦æ‰€æœ‰ç§Ÿæˆ¶å…±ç”¨)ï¼Œä½†åœ¨ Kubernetes é›†ç¾¤ä¸­æˆ‘å€‘å¯ä»¥é€éä¸€äº›é™åˆ¶é”åˆ°ç›¸å°å®‰å…¨çš„å¤šç§Ÿæˆ¶æ‡‰ç”¨çš„å½¢å¼ï¼Œä»¥ä¾¿æ›´æœ‰æ•ˆç‡åœ°åˆ©ç”¨è³‡æºã€‚</p>
<p>æˆ‘è¦ºå¾—é€™é‚Šè§£é‡‹æ‡‰è©²æ˜¯èªªï¼šå®‰å…¨æ€§ç†æƒ³ç‹€æ³ä¸‹ï¼Œä¸€å€‹ Kubernetes ç’°å¢ƒä¸­åªé‹è¡Œä¸€å€‹æ‡‰ç”¨ç¨‹å¼ï¼Œé€™æ˜¯<code>å–®ç§Ÿæˆ¶</code>ã€‚ ä½†æˆ‘å€‘é€éå° Namespace éš”é›¢ç­‰ç­‰çš„æ‰‹æ®µï¼Œä½¿å¾—æˆ‘å€‘å¯ä»¥è®“å¤šå€‹æ‡‰ç”¨ç¨‹å¼è·‘åœ¨åŒä¸€å€‹ clusterï¼Œä¸¦ç¢ºä¿å½¼æ­¤ä¹‹é–“ä¸æœƒäº’ç›¸å½±éŸ¿ä»¥é”æˆé‹è¡Œå¤šå€‹æ‡‰ç”¨åœ¨åŒä¸€å€‹ Kubernetes ç’°å¢ƒçš„éœ€æ±‚ï¼Œé€™æ˜¯<code>å¤šç§Ÿæˆ¶</code>ã€‚</p>
<p>å–®/å¤šç§Ÿæˆ¶å¯ä»¥æƒ³æˆæ˜¯æˆ¿å­çš„ä½æˆ¶å½¢å¼ã€‚ä¸€æ£Ÿé€å¤©ååªä½ä¸€æˆ¶å°±æœƒç›¸å°å®‰å…¨ï¼Œä¹Ÿä¸ç”¨æ¶è³‡æºï¼ˆå–®ç§Ÿæˆ¶ï¼‰ã€‚ å¦‚æœæ˜¯ä¸€æ£Ÿå…¬å¯“è£¡é¢ä½äº†å¾ˆå¤šæˆ¶ï¼Œè¦æ€éº¼å®‰æ’æ¯ä½ä½æˆ¶çš„è³‡æºåˆ†é…è·Ÿæ¯ä¸€æˆ¶çš„éš”é›¢æ€§ï¼Œå°±æœƒæ˜¯å•é¡Œäº†ï¼ˆå¤šç§Ÿæˆ¶ï¼‰ã€‚ï¼ˆç¸½ä¸èƒ½è®“ A éš¨ä¾¿ç©¿ç‰†å¯ä»¥è·‘åˆ° B å®¶ï¼Œæˆ–æ˜¯ A è¦æ´—æ¾¡ B å°±ä¸èƒ½æ´—ç¢—é€™é¡çš„ç‹€æ³ç™¼ç”Ÿï¼‰</p>
<p>æˆ‘è‡ªå·±åœ¨æ—¥å¸¸å¯¦è¸ä¸­ä¹Ÿå¤šæ˜¯ Soft å¤šç§Ÿæˆ¶ï¼Œåˆ‡ä¸åŒçš„ Namespace ä¸¦ç”¨ RBAC / Limits ä¾†åšé™åˆ¶çµ¦ä¸åŒçš„æ‡‰ç”¨ç¨‹å¼æˆ–æ˜¯ Team åšä½¿ç”¨ã€‚</p>
<p><br /></p>
<h3 id="soft-multi-tenant">Soft Multi-Tenant</h3>
<p>Soft å°±æ˜¯é€éé‚è¼¯å±¤éš”é›¢çš„æ–¹å¼ä¾†é”åˆ°é€™å€‹ç›®çš„ã€‚</p>
<ul>
<li>RBAC</li>
<li>Quotas</li>
<li>Limit ranges</li>
<li>Different Namespace</li>
</ul>
<p>ä»¥ä¸Šé€™äº›éƒ½æ˜¯åŸºæœ¬çš„ï¼Œä½†å»ä¸èƒ½é˜»æ­¢ Pod å…±äº«ä¸€å€‹ Instanceã€‚ ç‚ºä»€éº¼ä¸èƒ½å…±äº« Instance? å› ç‚ºæ©Ÿå™¨è£¡æœ‰æˆ‘å€‘çš„ secret / configmap / volume è³‡è¨Šï¼Œè¬ä¸€æ‰äº†ä¸€å°ï¼Œå¯èƒ½å°±ä¸€æ¬¡æ‰äº†å¥½å¹¾å€‹æ‡‰ç”¨ç¨‹å¼çš„æ©Ÿå¯†è³‡è¨Šã€‚ä½†é€™ä¸€åˆ‡ç«¯çœ‹ä½¿ç”¨è€…å°æ–¼éš”é›¢çš„ <code>éœ€è¦æ€§</code>ï¼Œè¦åšåˆ°å¼·åº¦å¤šé«˜çš„éš”é›¢ï¼Œå®Œå…¨æ˜¯ä¾ç…§æœ¬èº«çš„éœ€æ±‚è·Ÿé™åˆ¶å»åŸ·è¡Œçš„ï¼Œæ²’æœ‰æ¨™æº–ç­”æ¡ˆã€‚</p>
<p>å¦‚æœéœ€è¦æ›´å¼·å¤§çš„éš”é›¢ï¼Œå¯ä»¥è€ƒæ…®ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li>Node Selector</li>
<li>Anti-Affinity Rules</li>
<li>Taints / Tolerations</li>
</ul>
<p>é€™äº›æ–¹å¼å¯ä»¥è®“ Pod åªéƒ¨ç½²åœ¨ç‰¹å®šçš„æ©Ÿå™¨ä¸Šï¼Œä»¥é”åˆ°åº•å±¤æ©Ÿå™¨éš”é›¢çš„æ•ˆæœã€‚</p>
<p>Kiosk æ˜¯ä¸€æ¬¾å¯ä»¥å”åŠ©æˆ‘å€‘å°å…¥ soft multi-tenancy çš„å·¥å…·  <a href="https://github.com/kiosk-sh/kiosk">https://github.com/kiosk-sh/kiosk</a></p>
<p><br /></p>
<h3 id="hard-multi-tenant">Hard Multi-Tenant</h3>
<p>Hard å°±æ˜¯å¾ˆç¡¬çš„æŠŠæ¯å€‹ deployment æ”¾åœ¨ä¸åŒçš„ clusterï¼Œç•¶ç„¶é€™æ˜¯æœ€æœ‰æ•ˆçš„è³‡æºéš”é›¢æ–¹å¼ï¼Œä¹Ÿæ˜¯æ‰€è¬‚ 0 ä¿¡ä»»ã€‚<br>
ä½†æˆ‘å€‘å¿…é ˆè¦è€ƒæ…®åˆ°ï¼š</p>
<ul>
<li>æœƒè®Šå¾ˆè²´</li>
<li>å°è‡´è³‡æºåˆ©ç”¨ä¸è¶³</li>
<li>å¾ˆé›£ç®¡ç†</li>
</ul>
<p><br /></p>
<h3 id="conclusion">Conclusion</h3>
<pre><code>æ‰€ä»¥ä¸€èˆ¬æƒ…æ³ä¸‹é‚„æ˜¯è€ƒé‡ Soft multi-tenancy å°±å¯ä»¥äº†ã€‚
</code></pre><p>è€ƒé‡åˆ°ä¼æ¥­å¤šåŠæ˜¯æ¡å– <code>åŠä¿¡ä»»(semi-trusted)</code>ï¼Œäººæ˜¯ä¸å¯ä¿¡çš„æƒ…æ³ä¸‹ï¼Œå¿…é ˆå¾—è¦åšé©ç•¶çš„éš”é›¢ã€‚ä¸€èˆ¬ä¾†èªªç³»çµ±ç®¡ç†å“¡è² è²¬åˆ‡åˆ† Namespace ( by Application) ï¼Œä¸¦è³¦äºˆæ¯å€‹ Team æœ€å°æ‰€éœ€çš„æ¬Šé™ï¼ˆåªçµ¦éœ€è¦çš„Namespaceï¼‰ä¸¦æ­é… PSP ä½¿ç”¨ã€‚</p>
<p>è€Œè€ƒé‡åˆ° Soft/Hard éƒ½å„æœ‰å„ªç¼ºé»çš„æƒ…æ³ä¸‹ï¼ŒMulti-Tenancy Special Interest Group (SIG) æ­£åœ¨æ”¹å–„ Soft/Hard çš„ä¸è¶³ã€‚
æ­£æœè‘—ä»¥ä¸‹æ–¹å‘é‚é€²ï¼š</p>
<ul>
<li>Namespace åŠ å…¥ç¹¼æ‰¿çš„æ¦‚å¿µ (subnamespace)</li>
<li>Virtual Cluster (ä¸åŒ service å¯ä»¥å»ºç«‹å€‹åˆ¥çš„ Nodesï¼ŒNode è£¡åŒ…å« API / controller / schedulerï¼Œå°±æ˜¯æ‰€è¬‚<code>Kubernetes on Kubernetes</code>)</li>
</ul>
<p><br /></p>
<h2 id="EKS-DETECTIVE">EKS Detective Control</h2>
<hr>
<h3 id="auditing-and-logging">Auditing and Logging</h3>
<ul>
<li>ç¨½æ ¸ Log é€šå¸¸å¯ä»¥åˆ†æåŠç™¼ç¾å¾ˆå¤šå•é¡Œ</li>
<li>å»ºè­°å•Ÿç”¨ AuditLog on EKS, å°±æœƒé€åˆ° CloudwatchLogs (ä½†è¦æ”¶è²»)</li>
</ul>
<h3 id="åˆ©ç”¨-audit-log">åˆ©ç”¨ Audit Log</h3>
<p>Kubernetes audit log æœƒåŒ…å«å…©å€‹ annotations</p>
<ul>
<li><a href="http://authorization.k8s.io/decision"><code>authorization.k8s.io/decision</code></a> â†’ æŒ‡å‡º request æ˜¯å¦å·²æˆæ¬Š</li>
<li><a href="http://authorization.k8s.io/reason"><code>authorization.k8s.io/reason</code></a> â†’ æˆæ¬ŠåŸå› </li>
<li>å–„ç”¨å…©å€‹ annotations å»é©—è­‰ API Call æ˜¯å¦åˆæ³•</li>
</ul>
<h3 id="å»ºç«‹-cloudwatch-alarm">å»ºç«‹ CloudWatch Alarm</h3>
<ul>
<li>å»ºç«‹ CW Alarm åµæ¸¬ 401 / 403 Forbidden çš„ API Call æ•¸é‡ï¼Œä¸¦åœ¨æœ‰ 403/401 çš„æ™‚å€™å ±è­¦ã€‚</li>
<li>ç„¶å¾Œä½¿ç”¨ host / sourceIP / k8s_user.username å»æ‰¾å‡ºæ˜¯å“ªå€‹åœ°æ–¹çš„æ¼æ´ã€‚</li>
<li>æˆ–æ˜¯ä½¿ç”¨ CloudwatchLog Insight å»ç›£æ§</li>
<li>CloudTrail Log ä¹Ÿéœ€è¦ç›£æ§ (å› ç‚ºå¿…é ˆè¦çŸ¥é“ IRSA çš„ä½¿ç”¨ e.g. æ˜¯èª°å¾Podæ‰“äº† AWS API Call åˆ° S3)ã€‚</li>
</ul>
<h3 id="log-çš„ç®¡ç†">Log çš„ç®¡ç†</h3>
<p>Log ä¸€ç›´é•·å¤§ï¼Œç®¡ç†è·Ÿéæ¿¾è®Šå¾—è¶Šä¾†è¶Šéº»ç…©è·Ÿæ˜‚è²´ã€‚å¯ä»¥è€ƒæ…®ç”¨ <code>Falco</code> (CNCF) (Runtime security tool) åˆ†æ audit log åˆ†æç•°å¸¸ç¾è±¡ <a href="https://github.com/falcosecurity/falco">https://github.com/falcosecurity/falco</a></p>
<h4 id="--falco">- Falco</h4>
<ul>
<li>ç”¨ Helm å®‰è£åœ¨ EKS è£¡å°±å¯ä»¥ï¼Œé‚„æœ‰åŒ…å«é è¨­çš„ Rules</li>
<li>ä¸²æ¥ Lambda ç™¼é€ Alarm</li>
<li>å®˜æ–¹æ•™ç¨‹ï¼š <a href="https://aws.amazon.com/cn/blogs/china/securing-amazon-eks-lambda-falco/">https://aws.amazon.com/cn/blogs/china/securing-amazon-eks-lambda-falco/</a></li>
<li>é‚„å¯ä»¥ç”¨ ekscloudwatch å°‡ log å¾ CWLogs é€åˆ° Falco å»åšåˆ†æ <a href="https://github.com/sysdiglabs/ekscloudwatch">https://github.com/sysdiglabs/ekscloudwatch</a></li>
<li>å¦ä¸€å€‹é¸é …æ˜¯ S3 + SegaMaker</li>
</ul>
<p><br /></p>
<h2 id="EKS-Network-Security">EKS Network Security</h2>
<hr>
<p>Pod ä¹‹é–“é è¨­æ˜¯å¯ä»¥äº¤æµçš„ï¼Œé€™ä¸¦ä¸å®‰å…¨ã€‚ æ‰€ä»¥ Kuberentes Network æä¾›æˆ‘å€‘åœ¨ Pod ä¹‹é–“ç¶²è·¯åšé™åˆ¶çš„æ–¹æ³• (æ±è¥¿å‘æµé‡), æˆ–æ˜¯ Pod è·Ÿå¤–éƒ¨æœå‹™æºé€šçš„ç¶²è·¯é™åˆ¶æ–¹æ³•ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">ç°¡å–®ä¾†èªªå°±æ˜¯ Kubernetes è‡ªå·±çš„ Security Groupï¼Œåªæ˜¯æœ‰äº›åŒ…å«åˆ° OSI Layer 3 - 4ã€‚
</code></pre></div><p>å¸¸è¦‹çš„æœ‰ä»¥ä¸‹å¹¾ç¨®ï¼š</p>
<ul>
<li>Calico</li>
<li>Tigera</li>
<li>Cilium</li>
</ul>
<h3 id="encryption-in-transit-å‚³è¼¸æ™‚åŠ å¯†">Encryption in Transit (å‚³è¼¸æ™‚åŠ å¯†)</h3>
<ul>
<li>Nitro Instance (C5n, G4, I3en, M5dn, M5n, P3dn, R5dn, R5n) æ˜¯é è¨­å‚³è¼¸åŠ å¯†çš„ã€‚</li>
<li>CNI çš„é¸æ“‡ (ä½¿ç”¨ WeaveNet ä¹Ÿæœƒè‡ªå‹•åŠ å¯†)</li>
<li>Service Mesh ä¹Ÿå¯ä»¥åšåˆ°
<ul>
<li>AWS App Mesh â†’ SSL (ä½¿ç”¨ ACM Private Certificate )</li>
<li>Linkerd â†’ SSL</li>
<li>Istio â†’ SSL</li>
</ul>
</li>
<li>ä½¿ç”¨ Ingress Controller with HTTPS
<ul>
<li>ALB / NLB / CLB</li>
<li>å¦‚æœä½ è¦ Pod åˆ° Pod èµ° HTTPS æµé‡åŠ å¯†ï¼Œæ˜¯å¾ˆåƒ CPU è³‡æºçš„ï¼Œå› ç‚ºä½ æœƒéœ€è¦åœ¨ Pod åšåŠ è§£å¯†ä¸¦å»ºç«‹ handshakeï¼Œè€Œé€™å¾ˆæµªè²»è³‡æºï¼Œå› ç‚º Pod è³‡æºç†è«–ä¸Šæ˜¯è¦çµ¦æ‡‰ç”¨ç¨‹å¼åšä½¿ç”¨çš„ã€‚è¦ç›¡é‡åœ¨ Ingress (æœ€ä¸Šå±¤ï¼‰å»åšå®Œé€™ä»¶äº‹å°±å¯ä»¥äº†ã€‚</li>
</ul>
</li>
</ul>
<h3 id="recommendations-2">Recommendations</h3>
<ul>
<li>å»ºç«‹ K8S Network Policy æˆ– <code>Calico</code> è£¡é™åˆ¶ inbound/outbound æµé‡ã€‚
<ul>
<li>Kubernets Network Policy</li>
<li>Calico Global Network Policy</li>
</ul>
</li>
<li>ç›¡é‡è®“ Pod ä¹‹é–“ä½¿ç”¨ DNS æºé€šï¼Œä¸¦å»ºç«‹å…è¨± DNS (port: 53) æµé‡çš„è¦å‰‡ã€‚</li>
<li>åªå…è¨±å¿…è¦çš„æµé‡ã€‚</li>
<li>NLB / ALB è¦åŠ ä¸Š SSL Certificateã€‚</li>
</ul>
<p><br /></p>
<h2 id="EKS-SG">EKS Security Groups</h2>
<hr>
<p>å®˜æ–¹å»ºè­°ï¼š<a href="https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html">https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html</a></p>
<p>Node / Control Panel :<br>
- <strong>10250</strong> (kubelet needs)<br>
- <strong>443</strong> (API needs)
- é€™å…©å€‹ port ä¸€å®šè¦é–‹ã€‚</p>
<p>ç•¶æˆ‘å€‘å»ºç«‹ cluster çš„æ™‚å€™, SG æœƒè‡ªå‹•å¹«æˆ‘å€‘å»ºç«‹ã€‚</p>
<ul>
<li>ç‚ºç°¡å–®èµ·è¦‹ï¼Œå»ºè­° <code>å°‡ Control Panel çš„ SG ç›´æ¥åŠ åˆ° Worker SG</code> ç¢ºä¿æºé€šä¸Šæ²’æœ‰å•é¡Œã€‚</li>
<li>å¦‚æœéœ€è¦è·Ÿå¤–éƒ¨æœå‹™æºé€šï¼Œå¯ä»¥ä½¿ç”¨ Network Policy Engine (e.g. Cilium ä½¿ç”¨ DNS å»æºé€š) or (Calico ä½¿ç”¨ network policy å»å¹«ä½ å»ºç«‹ SG)</li>
<li>æˆ–æ˜¯ä½¿ç”¨ Service Mesh (Istio, app mesh) ä¹Ÿå¯ä»¥æ§åˆ¶ egress gateway</li>
<li><code>ä¸è¦åœ¨ Control Panel &amp; Managed Node Group ä¸Šé¢æ›åŒä¸€å€‹ SG</code>ï¼Œæœƒå¼•ç™¼ç„¡æ³•åˆªé™¤ Node Group çš„ Bugã€‚ <a href="https://docs.aws.amazon.com/eks/latest/APIReference/API_Issue.html">https://docs.aws.amazon.com/eks/latest/APIReference/API_Issue.html</a></li>
</ul>
<blockquote>
<p>å»ºè­°ä½¿ç”¨ Network Policy å»æ§åˆ¶çš„åŸå› æ˜¯å› ç‚ºæˆ‘å€‘ä¸æœƒåœ¨ä¸€å° Instance ä¸Šåªè·‘ä¸€å€‹ Pod ï¼Œæ‰€ä»¥ä½¿ç”¨æ§åˆ¶ VM Level çš„ SG å»æ§åˆ¶ Pod æœƒæœ‰é»ç²—ç³™ï¼Œç•¢ç«Ÿæˆ‘å€‘é‚„ç„¡æ³•æŠŠ SG å¥—ç”¨åœ¨å€‹åˆ¥çš„ Pod èº«ä¸Šã€‚</p>
</blockquote>
<p><br /></p>
<h2 id="EKS-RUNTIME">EKS Runtime Security</h2>
<hr>
<blockquote>
<p>ç›®çš„æ˜¯ç‚ºäº†é˜²æ­¢åœ¨ container å…§çš„æƒ¡æ„æ”»æ“Šï¼Œé˜²æ­¢è¢«å¾ container å…§åš system call æ‰“åˆ°åº•å±¤çš„ host kernelã€‚</p>
</blockquote>
<p>ç‚ºäº†é”åˆ°ç›®çš„ï¼Œæˆ‘å€‘æ‡‰è©²é™ç¸® application åˆ©ç”¨åˆ° system call çš„ç¯„åœã€‚
è€Œæˆ‘å€‘å¯ä»¥åˆ©ç”¨ <code>seccomp (secure cimputing)</code> ä¾†å”åŠ©ã€‚ seccomp æ˜¯ Linux çš„ä¸€å€‹å·¥å…·ï¼Œå¯ä»¥é™åˆ¶ process åªèƒ½å‘¼å«ç‰¹å®šçš„ system callã€‚</p>
<ul>
<li>syscall2seccomp  <a href="https://github.com/antitree/syscall2seccomp">https://github.com/antitree/syscall2seccomp</a></li>
</ul>
<p>è·Ÿ SELinux ä¸ä¸€æ¨£ï¼Œ<code>seccomp</code> ä¸æ˜¯è¦ç¨ç«‹å®¹å™¨ï¼Œä»–æ˜¯è¦ä¿è­· host kernel ä¸è¦è¢«æœªæˆæ¬Šçš„åŸ·è¡Œ syscallã€‚ä»–æœƒåªå…è¨±åœ¨ whitelist å…§çš„ syscallã€‚è€Œ Docker æœ‰é è¨­çš„ seccomp profile å¯ä»¥å»ä½¿ç”¨ä¸¦ç¬¦åˆå¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚</p>
<ul>
<li>seccomp åœ¨ kubelet ä¸Šæ˜¯ alpha feature, å¯ä»¥ä½¿ç”¨ <code>--seccomp-profile-root</code> å»å•Ÿç”¨ã€‚</li>
<li>ä½¿ç”¨ 3rd æ–¹æ¡ˆä¿è­· runtime
<ul>
<li>Apparmor</li>
<li>seccomp profile</li>
</ul>
</li>
</ul>
<p>è£œå……è³‡æ–™[Docker Seccomp Profile é…ç½®]ï¼š
<a href="https://blog.csdn.net/kikajack/article/details/79596843">https://blog.csdn.net/kikajack/article/details/79596843</a></p>
<p><br /></p>
<h2 id="EKS-HOST">EKS Infrastructure(Worker Node) Security</h2>
<hr>
<ul>
<li>
<p><strong>å®šæœŸæ±°æ› Node</strong></p>
<ul>
<li>å‡ç´šæ™‚ä¸è¦ in-placeï¼Œ<code>ç›´æ¥æŠŠ Node éƒ½æ›æˆæ–°çš„æ©Ÿå™¨</code> (Managed Node Group æ¨è–¦é€™æ¨£åš)ã€‚</li>
<li>Node Group æ•´çµ„æ›æ‰è‡ªå‹•åŒ–æ­¥é©Ÿï¼Œä»¥å…äººç‚ºå¤±èª¤ï¼ˆé€™å¾ˆå¸¸æœ‰å¤±èª¤ã€‚
<ul>
<li>å»ºç«‹æ–°çš„ Group</li>
<li>Drain containers</li>
<li>Terminate Old Instances</li>
</ul>
</li>
<li>Fargate æœƒè‡ªå‹•åœ¨æ¯æ¬¡å•Ÿå‹•éƒ½ä½¿ç”¨æ–°çš„ï¼Œé€™ä¹Ÿæ˜¯ä¸€ç¨®æ–¹æ³•ï¼ˆåŸæœ¬å°±æ˜¯ Fargate çš„å„ªé»ã€‚
<ul>
<li>ä½†æœƒå¸¸å¸¸è¢« rescheduleï¼Œå»ºè­°éƒ½ä½¿ç”¨ deployment / statefulsetã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>å®šæœŸæª¢æŸ¥ cluster æ˜¯å¦åˆä¹å®‰å…¨è¦ç¯„</strong></p>
<ul>
<li>kube-bench  <a href="https://github.com/aquasecurity/kube-bench#running-in-an-eks-cluster">https://github.com/aquasecurity/kube-bench#running-in-an-eks-cluster</a></li>
<li>kube-bench ç›®å‰ EKS AMI æœƒæœ‰å‡é™½æ€§å•é¡Œï¼Œæ­£åœ¨ issue è£¡ç­‰å¾…ä¿®å¾©</li>
</ul>
</li>
<li>
<p><strong>æœ€å°åŒ– Node æ¬Šé™</strong></p>
<ul>
<li>ä½¿ç”¨ SSM Session Manager å–ä»£ SSH (åæ­£ For Production ç†è«–ä¸Šä¹Ÿä¸æœƒå¸¸é€²å»)ã€‚</li>
<li>ä½† SSM Session Manager ç›®å‰æœ‰å•é¡Œï¼Œä½ æœƒéœ€è¦åœ¨ Host ä¸Šå®‰è£ SSM-Agentï¼Œé‚£å¦‚æœä½ ä¸€é–‹å§‹å°±æ‹”æ‰ SSHï¼Œåˆè¦æ€éº¼å»å®‰è£ï¼Ÿ (<code>é›ç”Ÿè›‹ã€è›‹ç”Ÿé›å•é¡Œ</code>)
<ul>
<li>ç›®å‰å¯ä»¥ä½¿ç”¨ä¸€å€‹ Privileged çš„ DaemonSet å»è·‘ Shell Script å»å®‰è£ï¼Œä½†è·‘å®Œå°±è¦æŠŠé€™å€‹ DaemonSet åˆªæ‰</li>
<li>ç­‰åˆ°å®˜æ–¹æ­£å¼æ”¯æ´å°±å¯ä»¥ä¸ç”¨å¹¹é€™ä»¶äº‹äº† QQ</li>
<li>The DaemonSet åƒè€ƒå®‰è£ï¼š  <a href="https://github.com/jicowan/ssm-agent-daemonset">https://github.com/jicowan/ssm-agent-daemonset</a></li>
<li>åŸç†æ˜¯åˆ©ç”¨ <code>nsenter</code> é€²åˆ°åˆ¥çš„ namespace å»ææ¬Šå®‰è£ ï¼ˆhackè‡ªå·±)</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>æŠŠ Worker Nodes æ”¾åœ¨ Private Subnets</strong></p>
<ul>
<li>åœ¨ 4/22, 2020 ä¹‹å‰å»ºç«‹çš„ NodeGroup éƒ½é è¨­æœƒçµ¦ Node Pulic IP, å¦‚æœæ˜¯é€™æ¨£ä½ å¯ä»¥é€é SG é™åˆ¶ã€‚</li>
<li>ä¹‹å¾Œçš„éƒ½æœƒæ ¹æ“š Subnet ä¾†æ±ºå®šè¦ä¸è¦çµ¦ Public IPï¼Œæ‰€ä»¥æŠŠ Worker Node æ”¾åœ¨ Private Subnet å°± ok äº†ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨ Amazon Inspector ä¾†æª¢é©—æ˜¯å¦æœ‰æ¼æ´</strong><br>
<a href="https://docs.aws.amazon.com/zh_tw/inspector/latest/userguide/inspector_introduction.html">https://docs.aws.amazon.com/zh_tw/inspector/latest/userguide/inspector_introduction.html</a><br>
Amazon Inspector æœƒæ¸¬è©¦ Amazon EC2 instances çš„ç¶²è·¯å­˜å–èƒ½åŠ›ï¼Œä»¥åŠé€™äº›åŸ·è¡Œå€‹é«”ä¸ŠåŸ·è¡Œçš„æ‡‰ç”¨ç¨‹å¼å®‰å…¨æ€§ç‹€æ…‹ã€‚Amazon Inspector æœƒè©•ä¼°æ‡‰ç”¨ç¨‹å¼æ˜¯å¦æœ‰æ¼æ´èˆ‡å¼±é»ï¼Œä»¥åŠæ˜¯å¦åé›¢æœ€ä½³å¯¦å‹™ã€‚åŸ·è¡Œè©•ä¼°å¾Œï¼Œæœƒç”¢ç”Ÿå®‰å…¨èª¿æŸ¥çµæœçš„è©³ç´°æ¸…å–®ï¼Œä¸¦ä¾åš´é‡ç¨‹åº¦æ’åˆ—ã€‚</p>
<ul>
<li>æœƒéœ€è¦å®‰è£ä¸€å€‹ deployment å»ç›£æ§æ©Ÿå™¨ä¸Šçš„æ´»å‹•ã€‚</li>
<li>å¦‚æœä½ ç”¨ NodeGroup çš„è©±ç›®å‰ä¸æ”¯æ´ä½ ä½¿ç”¨è‡ªå·±çš„ AMIï¼Œæ‰€ä»¥ä½ æœƒéœ€è¦åœ¨ NodeGroup å¹«ä½ å•Ÿå‹• (bootstrapped) å‰å…ˆå°‡ Agent å®‰è£å¥½ã€‚</li>
<li>Fargate ä¸èƒ½è·‘ Inspectorã€‚</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨å„ªåŒ–çš„ OS (Container å°ˆç”¨)</strong></p>
<ul>
<li>RancherOS</li>
<li>Bottlerocket ğŸ”¥</li>
</ul>
</li>
<li>
<p><strong>å…¶ä»–æ›¿ä»£åšæ³•ï¼š ä½¿ç”¨ SELinux</strong><br>
<a href="https://platform9.com/blog/selinux-kubernetes-rbac-and-shipping-security-policies-for-on-prem-applications/">SELinux, Kubernetes RBAC, and Shipping Security Policies for On-prem Applications</a></p>
</li>
</ul>
<p><br />
<br /></p>

    <br /><br />
<iframe class="LikeCoin" height="200" src="https://button.like.co/in/embed/davidh83110/button?referrer=%2fblog%2f2020-05-26-eks-best-practices-security%2f" width="55%" frameborder=0></iframe>

  </div>
  <section id="socnet-share" style="justify-content: center; margin: 1em 1em 2em;">
    





  
    <a href="https://telegram.me/share/url?text=EKS%20Best%20Practices%20-%20Security&url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn telegram">
        <i class="fab fa-telegram-plane fa-5x"></i><p>&nbsp;Line</p>
      </a>
  

  
    <a href="https://social-plugins.line.me/lineit/share?url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn line">
        <i class="fab fa-line fa-5x"></i><p>&nbsp;Line</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn facebook">
        <i class="fab fa-facebook"></i><p>&nbsp;Facebook</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f&amp;title=EKS%20Best%20Practices%20-%20Security" target="_blank" rel="noopener" class="share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by David&amp;body=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" class="share-btn email" data-proofer-ignore>
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  

  
    
    <a href="//twitter.com/share?text=EKS%20Best%20Practices%20-%20Security&amp;url=https%3a%2f%2fblog.davidh83110.com%2fblog%2f2020-05-26-eks-best-practices-security%2f" target="_blank" rel="noopener" class="share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  


    <br />
  </section>
  <footer>
    <ul class="stats">
  
    
    
      <li class="categories">
        <ul>
          
            
            <li><a class="article-category-link" href="/categories/aws">AWS</a></li>
          
            
            <li><a class="article-category-link" href="/categories/kubernetes">Kubernetes</a></li>
          
        </ul>
      </li>
    
  
  
    <li class="tags">
      <ul>
        <li>-</li>
      </ul>
    </li>
  
</ul>

  </footer>
</article>

    <article class="post">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "davidh83110" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>




<div class="pagination">
  
    <a href="/aws/kubernetes/%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE/terraform/2020/05/14/eks-external-dns.html" class="button"><div class="previous"><div>EKS External-DNS Cross Account Route53 Setup</div></div></a>
  
  
    <a href="/blog/2021-06-24-eks-awslbcontroller-gracefully-rolling-update/" class="button"><div class="next"><div>Solved - AWS LoadBalancer Controller Cannot Gracefully Rolling Update</div></div></a>
  
</div>


      </main>
      <section id="site-sidebar">






  
    
      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
            
          
          
          <li>
            
              <a href="/categories/aws/">aws<span class="count">8</span></a>
            
          
          <li>
            
              <a href="/categories/jibber-jabber/">jibber-jabber<span class="count">7</span></a>
            
          
          <li>
            
              <a href="/categories/kubernetes/">kubernetes<span class="count">4</span></a>
            
          
          <li>
            
              <a href="/categories/owasp/">owasp<span class="count">3</span></a>
            
          
          <li>
            
              <a href="/categories/python/">python<span class="count">3</span></a>
            
          
          <li>
            
              <a href="/categories/security/">security<span class="count">3</span></a>
            
          
          <li>
            
              <a href="/categories/architecture/">architecture<span class="count">2</span></a>
            
          
          <li>
            
              <a href="/categories/terraform/">terraform<span class="count">2</span></a>
            
          
          <li>
            
              <a href="/categories/linux/">linux<span class="count">1</span></a>
            
          
          <li>
            
              <a href="/categories/mongodb/">mongodb<span class="count">1</span></a>
            
          
          <li>
            
              <a href="/categories/serverless/">serverless<span class="count">1</span></a>
            
          
          </li>
        </ul>
      </section>
    
  


  
    <section id="recent-posts">
      <header>
        <h1>Recent posts</h1>
      </header>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/2021-06-24-eks-awslbcontroller-gracefully-rolling-update/" class="image featured">
    
    <p style="text-align: center;">
      <img src="https://live.staticflickr.com/65535/51268214173_8bbd7a3200_z.jpg" alt="">
    </p>
    
  </a>


        </section>
        <header>
          <h4><a href="/blog/2021-06-24-eks-awslbcontroller-gracefully-rolling-update/">Solved - AWS LoadBalancer Controller Cannot Gracefully Rolling Update</a></h4>
          <time class="published" datetime="">June 24, 2021</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/blog/2020-05-26-eks-best-practices-security/" class="image featured">
    
    <p style="text-align: center;">
      <img src="https://live.staticflickr.com/65535/49970338736_ffd25b0434_b.jpg" alt="">
    </p>
    
  </a>


        </section>
        <header>
          <h4><a href="/blog/2020-05-26-eks-best-practices-security/">EKS Best Practices - Security</a></h4>
          <time class="published" datetime="">June 7, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/aws/kubernetes/%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE/terraform/2020/05/14/eks-external-dns.html" class="image featured">
    
    <p style="text-align: center;">
      <img src="https://live.staticflickr.com/65535/49908288961_c380509717_b.jpg%20width=10" alt="">
    </p>
    
  </a>


        </section>
        <header>
          <h4><a href="/aws/kubernetes/%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE/terraform/2020/05/14/eks-external-dns.html">EKS External-DNS Cross Account Route53 Setup</a></h4>
          <time class="published" datetime="">May 14, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/aws/kubernetes/%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE/terraform/2020/03/30/eks-install.html" class="image featured">
    
    <p style="text-align: center;">
      <img src="https://live.staticflickr.com/65535/49715657891_23558e7f5d_k.jpg" alt="">
    </p>
    
  </a>


        </section>
        <header>
          <h4><a href="/aws/kubernetes/%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE/terraform/2020/03/30/eks-install.html">EKS Building &amp; Troubleshooting</a></h4>
          <time class="published" datetime="">March 30, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
  <a href="/%E6%8A%80%E8%A1%93%E7%B0%A1%E4%BB%8B/2020/03/05/saas-self-hosted.html" class="image featured">
    
    <p style="text-align: center;">
      <img src="https://live.staticflickr.com/65535/49618259028_e4784532cf_h.jpg" alt="">
    </p>
    
  </a>


        </section>
        <header>
          <h4><a href="/%E6%8A%80%E8%A1%93%E7%B0%A1%E4%BB%8B/2020/03/05/saas-self-hosted.html">SaaS/Managed Services &amp; Self-Hosted è¡ä¼¸æ€è€ƒ</a></h4>
          <time class="published" datetime="">March 5, 2020</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          

        </section>
        <header>
          <h4><a href="/aws/%E7%B3%BB%E7%B5%B1%E5%BB%BA%E7%BD%AE/2020/02/15/cloud-native-log-solution.html">Cloud-Native LOG å„²å­˜ä»¥åŠåˆ†ææ–¹æ¡ˆ</a></h4>
          <time class="published" datetime="">February 15, 2020</time>
        </header>
      </article>
      
      
        <footer>
          <a href="/blog/" class="button">See more</a>
        </footer>
      
    </section>
  


</section>
      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        <li><a href="//github.com/davidh83110" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

<li><a href="//stackoverflow.com/users/12397001" target="_blank" rel="noopener" title="Stack Overflow" class="fab fa-stack-overflow"></a></li>









<li><a href="//linkedin.com/in/david-hsu-b1136112b" target="_blank" rel="noopener" title="LinkedIn" class="fab fa-linkedin"></a></li>




<li><a href="//facebook.com/ben12567" target="_blank" rel="noopener" title="Facebook" class="fab fa-facebook"></a></li>








<li><a href="//instagram.com/davidh.110" target="_blank" rel="noopener" title="Instagram" class="fab fa-instagram"></a></li>













<li><a href="mailto:davidh83110@gmail.com" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
  
  <p class="copyright">
    
      &copy; 2021
      
        David&#39;s Blog
      
    . <br>
    Theme: <a href='https://github.com/pacollins/hugo-future-imperfect-slim' target='_blank' rel='noopener'>Hugo Future Imperfect Slim</a><br>A <a href='https://html5up.net/future-imperfect' target='_blank' rel='noopener'>HTML5 UP port</a> | Powered by <a href='https://gohugo.io/' title='0.71.1' target='_blank' rel='noopener'>Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script><script src="/js/bundle.min.ba01f4c6fd09c8681f5bb9960755a2d29a543735c990ef92c5c97365cbb37a4e.js" integrity="sha256-ugH0xv0JyGgfW7mWB1Wi0ppUNzXJkO&#43;SxclzZcuzek4="></script>
    <script src="/js/add-on.js"></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-85468802-6', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </div>
  </body>
</html>
